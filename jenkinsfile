library identifier: 'custom-lib@main', retriever: modernSCM(
  [$class: 'GitSCMSource',
   remote: 'https://github.com/ganesh770924/shared-lib.git'])

pipeline{
    agent any
    tools{
        maven "maven3"
        
    }
    environment{
        SONARSERVER ="sonar"
        SONARSCANNER = "sonar"
      
            }
    stages{
        stage('checkout'){
            steps{
                script{
                    checkout()
                }
            }
        }
        stage('Build'){
            steps{
                script{
                    pipeline.Build()
                }
            }
        }
        stage('Junit test'){
            steps{
                script{
                    pipeline.test()
                }
            }
        }
        stage('CODE ANALYSIS with SONARQUBE'){
             environment{
               scannerHome = tool "${SONARSCANNER}"
      
            }
            steps{
                withSonarQubeEnv("${SONARSERVER}"){
                script{
                    pipeline.sonarscanner()
                }
              }
            }
        }
        stage('Upload artifact'){
            steps{
                script{
                    pipeline.upartifacts()
                }
            }
        }
        
        stage('Upload Deploy'){
            steps{
                script{
                    pipeline.deploy()
                }
            }
        }
    }
        }
    
